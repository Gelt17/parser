# Парсер бюллетеней торгов СПБМТСБ

Парсер для скачивания и обработки бюллетеней по итогам торгов с сайта биржи СПБМТСБ.

## Описание

Программа автоматически:
- Скачивает бюллетени по итогам торгов с сайта https://spimex.com
- Извлекает данные из таблицы "Единица измерения: Метрическая тонна"
- Фильтрует записи с количеством договоров > 0
- Сохраняет структурированные данные в базу данных PostgreSQL
- Создает необходимые таблицы если они не существуют

## Требования

- Python 3.12
- PostgreSQL 17
- Доступ к интернету для скачивания файлов

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/Gelt17/parser.git
cd parser
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Настройте подключение к базе данных:
   - Создайте файл `.env` в корневой директории проекта
   - Добавьте в него строку с вашими параметрами подключения:
   
```
DATABASE_URL = "postgresql://username:password@localhost:5432/database_name"
```

   Замените:
   - `username` на ваше имя пользователя PostgreSQL
   - `password` на ваш пароль
   - `localhost` на хост базы данных (если необходимо)
   - `5432` на порт (если используете нестандартный порт)
   - `database_name` на имя вашей базы данных

## Использование

Запустите парсер следующей командой:

```bash
python main.py
```

Программа:
- Создаст необходимые таблицы в базе данных (если они не существуют)
- Скачает бюллетени за период с 2023 года по текущую дату
- Обработает каждый файл и извлечет данные
- Сохранит данные в таблицу `spimex_trading_results`
- Выведет время выполнения и количество сохраненных записей

## Структура базы данных

Данные сохраняются в таблицу `spimex_trading_results` со следующими полями:
- `id` - первичный ключ
- `exchange_product_id` - код инструмента
- `exchange_product_name` - наименование инструмента
- `oil_id` - код продукта (первые 4 символа exchange_product_id)
- `delivery_basis_id` - базис поставки (символы 4-7 exchange_product_id)
- `delivery_basis_name` - наименование базиса поставки
- `delivery_type_id` - тип поставки (последний символ exchange_product_id)
- `volume` - объем договоров в тоннах
- `total` - объем договоров в рублях
- `count` - количество договоров
- `date` - дата торгов
- `created_on` - метка времени создания записи
- `updated_on` - метка времени обновления записи

## Примечания

- Сделано 90306 записей
- Время выполнения программы: 702.09 секунд с парсингом сайта и  загрузкой excel-таблиц
- Время выполнения программы: 80.31 секунд скрипта и занесения данных в таблицу

![alt text](image.png)
![alt text](image-1.png)